#pragma once
#include <stdint.h>
#include <stdbool.h>
#include "gfx.h"

// =========================
// Bitmaps (from your paste)
// Format: 1bpp vertical pages
// =========================

static const uint8_t bmp_tile[] = {
		0x38,0x44,0x82,0x29,0x11,0x29,0x82,0x44,0x38,0x44,0x82,0x11,0x29,0x11,
		0x82,0x44,0x38,0x44,0x82,0x11,0x29,0x11,0x82,0x44,0x38,0x44,0x82,0x29,
		0x11,0x29,0x82,0x44,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x00,
		0x00,0x01,0x01,0x01,0x00,0x00
};

static const uint8_t googledino20x20_dead []  = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xfe, 0xf2, 0xf2, 0x7e, 0x3e,
		0x3e, 0x3e, 0x1e, 0x1c, 0x07, 0x1f, 0x3e, 0x7c, 0xfc, 0xfc, 0xfc, 0xfe, 0xfe, 0xff, 0xff, 0xff,
		0x3f, 0x1f, 0x02, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x0b, 0x09,
		0x00, 0x01, 0x0f, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	};

static const uint8_t bird_down_14x12 [] = {
		0x08, 0x0c, 0x0e, 0x1f, 0xfe, 0xfc, 0xfc, 0xfc, 0x78, 0x78, 0x38, 0x38, 0x28, 0x28, 0x00, 0x00,
					0x00, 0x00, 0x0f, 0x07, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static const uint8_t bird_up_14x12 [] = {
		0x00, 0x80, 0xc0, 0xe0, 0xc0, 0x87, 0xfe, 0xfc, 0xf8, 0xf0, 0xe0, 0x80, 0x00, 0x00, 0x01, 0x01,
			0x01, 0x03, 0x07, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x07, 0x07, 0x05, 0x05
};

static const uint8_t sword13x13_up []  = {
		0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0xa0, 0x50, 0x28, 0x14, 0x0a, 0x05, 0x03, 0x10, 0x09, 0x07,
		0x05, 0x0e, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	};

static const uint8_t sword19x7_down []  ={
	0x08, 0x08, 0x08, 0x55, 0x2a, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14,
	0x14, 0x1c, 0x08
};



static const uint8_t googledino20x20_right [] =  {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xfe, 0xfa, 0xfe, 0x7e, 0x5e,
		0x5e, 0x5e, 0x1e, 0x1c, 0x07, 0x1f, 0x3e, 0x7c, 0xfc, 0xfc, 0xfc, 0xfe, 0xfe, 0xff, 0xff, 0xff,
		0x3f, 0x1f, 0x02, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x0b, 0x09,
		0x00, 0x01, 0x0f, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	};

static const uint8_t googledino20x20_left [] ={
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xfe, 0xfa, 0xfe, 0x7e, 0x5e,
	0x5e, 0x5e, 0x1e, 0x1c, 0x07, 0x1f, 0x3e, 0x7c, 0xfc, 0xfc, 0xfc, 0xfe, 0xfe, 0xff, 0xff, 0x7f,
	0x3f, 0x1f, 0x02, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x05, 0x01,
	0x00, 0x00, 0x0f, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static const uint8_t googledino16x16_clear [] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
		};


static const uint8_t ground [] = {
0x40, 0x00, 0x00, 0x08, 0x08, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x04, 0x04, 0x04, 0x20,
0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x10,
0x10, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x40, 0x42, 0x02, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x10, 0x00, 0x04, 0x00, 0x20, 0x20, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x04,
0x24, 0x04, 0x00, 0x00,0x40, 0x00, 0x00, 0x08, 0x08, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x04, 0x04, 0x04, 0x20,
0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x10,
0x10, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x40, 0x42, 0x02, 0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x10, 0x00, 0x04, 0x00, 0x20, 0x20, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x04,
0x24, 0x04, 0x00, 0x00
};

// cactus[] length = 12 bytes => default assume 6x16 (6 * ceil(16/8)=6*2=12).
// If it draws wrong, change these two macros.
#define CACTUS_W 6
#define CACTUS_H 16

static const uint8_t cactus[] = {
    0xC0,0x00,0xF0,0xF0,0x00,0x00,0x03,0x02,0xFF,0xFF,0x08,0x0F
};


static const uint8_t cactus_dead3x7[]  ={
		0x00, 0x7c, 0x7c
	};

// =========================
// Sprite descriptors
// =========================
static const SpriteV8 SPR_DINO_R   = { 20, 20, googledino20x20_right };
static const SpriteV8 SPR_DINO_L   = { 20, 20, googledino20x20_left  };
static const SpriteV8 SPR_DINO_DIE = { 20, 20, googledino20x20_dead  };

static const SpriteV8 SPR_BIRD_UP   = { 14, 12, bird_up_14x12   };
static const SpriteV8 SPR_BIRD_DOWN = { 14, 12, bird_down_14x12 };

static const SpriteV8 SPR_CACTUS_TINY_DEAD = { 3, 7, cactus_dead3x7 };
static const SpriteV8 SPR_CACTUS = { CACTUS_W, CACTUS_H, cactus };

// =========================
// Game API
// =========================
typedef enum {
    INPUT_NONE = 0,
    INPUT_JUMP,
    INPUT_LEFT,
    INPUT_RIGHT,
    INPUT_RESET,
    INPUT_PAUSE
} InputEvent;

typedef enum {
    OBS_NONE = 0,
    OBS_CACTUS,
    OBS_BIRD
} ObstacleType;

typedef struct {
    ObstacleType type;
    int x;
    int y;
    bool active;
    bool anim;   // bird flapping
} Obstacle;

#define MAX_OBS 6

typedef struct {
    // Dino state
    int x;
    int y;
    int vy;
    bool on_ground;
    int facing;        // -1 left, +1 right

    // World
    int ground_y;
    int scroll_speed;

    // Obstacles
    Obstacle obs[MAX_OBS];

    // Game
    bool running;
    bool game_over;
    uint32_t score;
    uint32_t tick;

    // spawn pacing
    uint32_t next_spawn_tick;
} GameState;

void game_init(GameState *g);
void game_handle_input(GameState *g, InputEvent ev);
void game_update(GameState *g);
void game_render(const GameState *g, Framebuffer *fb);
